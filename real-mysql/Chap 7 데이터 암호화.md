# 데이터 암호화

- MySQL 5.7버전부터 데이터 파일만 암호화 기능을 제공
- MySQL 8.0버전부터 데이터 파일, redo log, undo log, 바이너리 로그 등에 암호화를 지원

# MySQL 서버의 데이터 암호화

- 데이터 입출력(IO)시에만 데이터 암호화 처리가 필요함
- TDE(Transparent Data Encryption)
    - 암호화된 데이터나 암호화 되지 않은 데이터나 동일하게 처리하는 것

# 2단계(2-Tier) 키 관리

<img width="650" alt="스크린샷 2022-02-23 오후 8 55 08" src="https://user-images.githubusercontent.com/66231761/155314673-7bbb57aa-98b7-467c-a7a7-3c845a5a14be.png">

- KeyRing 플러그인
    - 마스터키와 테이블스페이스 키를 생성하고 관리함
- 테이블스페이스 키
    - private key
    - 암호화된 테이블이 생성될 때마다 임의의 테이블스페이스 키를 발급
    - MySQL 서버는 마스터키로 테이블스페이스 키를 암호화해서 각 테이블 헤더에 저장
    - 테이블스페이스 키는 MySQL 서버 외부로 노출되지 않아서 변경하지 않아도 됨
- 마스터 키
    - 테이블스페이스 키는 마스터 키로 다시 암호화됨
    - MySQL 서버는 외부 키관리 솔루션이나 디스크 파일로부터 마스터 키를 가져옴
    - 마스터 키는 주기적으로 변경해야 함

# 왜 2단계 키 관리를 사용할까?

- 테이블스페이스 키 변경으로 인한 과도한 시스템 부하를 줄이기 위해 사용
- 테이블스페이스 키가 변경되면 데이터 파일의 모든 데이터를 복호화했다가 다시 암호화해야함

# 암호화와 압축이 동시에 적용되면 왜 압축을 먼저 실행하고 암호화를 적용할까?

- 암호화된 결과는 랜덤한 바이트 배열을 가지는데 이는 압축률을 떨어뜨리기 때문
- 압축후에 innoDB 버퍼 풀에서 압축 또는 압축 해제 상태로 존재할 수 있는데 암호화된 데이터를 버퍼 풀에 적재하지 않기 위해서

# 응용 프로그램에서 직접 암호화를 적용해서 데이터를 저장했을 때 vs TDE로 암호화했을 때

- 직접 암호화를 적용하면 암호화되기 전의 값을 기준으로 정렬할 수 없다
- TDE는 데이터 페이지를 저장하기 직전에만 암호화하므로 제약이 없다
